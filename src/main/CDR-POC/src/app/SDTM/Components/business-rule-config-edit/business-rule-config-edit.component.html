<kendo-dialog *ngIf="active" (close)="closeForm()" [width]="450">
  <kendo-dialog-titlebar style="background-color : white;border-radius: 30px 30px 0 0">
      <span *ngIf="(isNew=='add' || isNew=='edit')">
          <a (click)="switchFlag()"  *ngIf="this.editBusinessForm.value.flag == 'Y'">
              <img src="assets/images/Flag.png" style="height: 25px;width: 25px;" class="pull-left"/>
          </a>
          <a (click)="switchFlag()" *ngIf="this.editBusinessForm.value.flag == 'N'">
            <img src="assets/images/UnFlag.png" style="height: 25px;width: 25px;" class="pull-left"/>
          </a>
      </span>
    <span *ngIf="(isNew=='add')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Create New Business
        Rule</b></span>
    <span *ngIf="(isNew=='edit')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Edit Business Rule</b></span>
    <span *ngIf="(isNew=='import')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Import Business
        Rules</b></span>
    <span *ngIf="(isNew=='delete')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Confirm Delete</b></span>
    <span *ngIf="(isNew=='objectLevel')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Source Form Join Logic â€“ {{this.domainName}}</b></span>
    <span *ngIf="(isNew=='domainStatus')"><b style="color : black;font-size: 14px;font-family: Open Sans;">Confirm Status Change</b></span>
  </kendo-dialog-titlebar>
  <!-- <kendo-dialog-titlebar style="background-color : white;border-radius: 30px 30px 0 0;padding: 5px;" *ngIf="(isNew=='delete')">
    <b style="color : black;font-size: 14px;font-family: Open Sans;">Confirm Delete</b>
  </kendo-dialog-titlebar> -->
  <form novalidate [formGroup]="editBusinessForm" *ngIf="(isNew=='add' || isNew=='edit')">
    <div class="container" style="background-color: white">
      <!-- <div class="row">
        <div class="col-25">
          <label for="study" style="font-size:14px;font-family: serif;font-weight:bold;color:black">Study:</label>
        </div>
        <div class="col-75">
          <input type="text"  formControlName="study" />&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="domain" style="font-size:14px;font-family: serif;font-weight:bold;color:black">Domain:</label>
        </div>
        <div class="col-75">
          <input type="text"  formControlName="domain" />&nbsp;&nbsp;     
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="subDomain" style="font-size:14px;font-family: serif;font-weight:bold;color:black">Sub Domain:</label>
        </div>
        <div class="col-75">
           <input type="text" formControlName="subDomain" />&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="targetFile" style="font-size:14px;font-family: serif;font-weight:bold;color:black">Target File:</label>
        </div>
        <div class="col-75">
          <input type="text" placeholder="Select Target File" formControlName="targetFile" />&nbsp;&nbsp;
        </div> 
      </div>-->
      <div class="row">
        <div>
          <kendo-popup [offset]="offset" *ngIf="opened">
            <div *ngIf="opened" style="color : #f31700;font-size:12px;font-family: Open Sans;"><b> {{errorMsg}} </b></div>
          </kendo-popup>
        </div>
        <div class="col-25">
          <label for="targetField">SDTM Variable:</label>
        </div>
        <div class="col-75">
          <!--<input type="text" placeholder="Select Variable Name" formControlName="targetField"/>&nbsp;&nbsp;-->
          <select placeholder="Select Variable Name" formControlName="targetField">
            <option [ngValue]="null" disabled selected style="display: none;" class="defaultOption">Select Variable
              Name</option>
            <option *ngFor="let variable of sdtmVariables" value="{{variable}}">{{variable}}</option>
          </select>&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="sourceFile">Source Form:</label>
        </div>
        <div class="col-75">
          <!--<input type="text" placeholder="Select Source File" formControlName="sourceFile"/>&nbsp;-->
          <select placeholder="Select Source File" formControlName="formName" (change)="onSelect($event.target.value)">
            <option value="null" disabled selected style="display: none;" class="defaultOption">Select Source Name</option>
            <option *ngFor="let table of lookupTables" value="{{table[0]}}">{{table[1]}}</option>
          </select>&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="sourceField">Source Variable:</label>
        </div>
        <div class="col-75">
          <!-- <input type="text" placeholder="Select Source Variable" formControlName="sourceField" />&nbsp;&nbsp;-->
          <select placeholder="Select Source Variable" formControlName="sourceFile" (change)="onSelectVariable($event.target.value)">
            <option value="null" disabled selected style="display: none;" class="defaultOption">Select Variable Name</option>
            <option *ngFor="let variable of lookupVariables" value="{{variable.fieldName}}">{{variable.fieldDesc}}</option>
          </select>&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="joinLogic">Join Logic:</label>
        </div>
        <div class="col-75">
          <input type="text" placeholder="Enter Logic Statement" formControlName="joinLogic" />&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="transformation_type">Transformation Type:</label>
        </div>
        <div class="col-75">
          <select placeholder="Select Transformation" formControlName="transformation_type" (change)="changePlaceholderAndValue($event.target.value)">
            <option [ngValue]="null" disabled selected style="display: none;" class="defaultOption">Select Type</option>
            <option *ngFor="let type of transTypes" value="{{type.transType}}">{{type.transType}}</option>
          </select>&nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="transformation_logic">Transformation Logic:</label>
        </div>
        <div class="col-75">

          <textarea placeholder="{{transPlaceHolder}}" formControlName="transformation_logic"></textarea> &nbsp;&nbsp;
        </div>
      </div>
      <div class="row">
          <div class="col-25">
            <label for="Note text">Note Text:</label>
          </div>
          <div class="col-75">
            <textarea placeholder="Enter note" formControlName="notes"></textarea> &nbsp;&nbsp;
          </div>
        </div>
    </div>
  </form>
  <form name="form" [formGroup]="editBusinessForm" novalidate *ngIf="(isNew=='import')">
    <div class="container" style="background-color: white;">

      <div *ngIf="opened" style="color : #f31700;font-size:12px;font-family: Open Sans;">{{errorMsg}}</div>
      <div style="color :#333;font-size:12px;font-family: Open Sans;text-align: left;font-weight: bold;">{{defaultMessage}}</div>
      <div class="row">
        <div class="col-25">
          <label style="padding-bottom: 0px;" for="I want to create a new set of rules for">I want to create a new set
            of rules for:</label>
        </div>
        <div class="col-75">
          <select placeholder="Select study" formControlName="study">
            <option [ngValue]="null" disabled selected style="display: none;" class="defaultOption">Study Title</option>
            <option *ngFor="let title of studyTitles" value="{{title}}">{{title}}</option>
          </select>&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label style="padding-bottom: 0px;" for="Using this library/study as a template">Using this library/study as
            a template:</label>
        </div>
        <div class="col-75">
          <select placeholder="Select study" formControlName="matrixStudy" (change)="filterDomains($event.target.value);">
            <option [ngValue]="null" disabled selected style="display: none;" class="defaultOption">Study Title</option>
            <option *ngFor="let matrixStudy of matrixStudyTitles" value="{{matrixStudy}}">{{matrixStudy}}</option>
          </select>&nbsp;
        </div>
      </div>
      <div class="row">
        <div class="col-25">
          <label for="For this domain">For these domains: </label>
        </div>
        <div class="col-75">
          <!--<select placeholder="Select study" formControlName="domain">
                  <option  [ngValue]="null" disabled selected style="display: none;">Domain</option>
                  <option *ngFor="let domain of studyDomains" value="{{domain}}">{{domain}}</option>
                </select>-->
          <kendo-multiselect style="width: 80%; font-size:11px;font-family: Open Sans;border-color: #ccc" [data]="studyPopDomains"
            formControlName="importDomain" [autoClose]="true" placeholder="Domain" [textField]="'domainLabel'"
            [valueField]="'domain'">
            <!--<ng-template kendoMultiSelectSummaryTag let-dataItem>
                  <label>{{ dataItem }}</label>
                </ng-template>-->
          </kendo-multiselect>
          &nbsp;
        </div>
      </div>

    </div>
  </form>
  <form novalidate [formGroup]="editBusinessForm" *ngIf="(isNew=='delete')">
    Are you sure you want to delete this business rule?
  </form>
  <form novalidate [formGroup]="editBusinessForm" *ngIf="(isNew=='domainStatus')">
      Are you sure you want to change this domain's status to <b>{{this.editBusinessForm.value.domainStatus}}</b>? 
    </form>
  <div *ngIf="(isNew=='objectLevel')">
    <kendo-grid [data]="this.gridData | async" [height]="162" style="width: 100%;" [sortable]="sortable"> 
              <kendo-grid-column [width]="125" [style]="{'text-align':'left'}" [headerStyle]="{'text-align':'center','font-family': 'Open Sans Regular','font-size': '12px','background-color': '#074982','color':'white'}"
                field="formLable" title="Source Form">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                  {{dataItem[2]}}
                </ng-template>
               </kendo-grid-column>
              <kendo-grid-column [width]="150" [style]="{'text-align':'left'}" [headerStyle]="{'text-align':'center','font-family': 'Open Sans Regular','font-size': '12px','background-color': '#074982','color':'white'}"
                field="joinLogic" title="Join Logic">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                    {{dataItem[3]}}
                  </ng-template>
                <ng-template kendoGridNoRecordsTemplate>
                    <span *ngIf="searchBRStudy != null && searchBRStudy.brSdtmDomain != null && searchBRStudy.brStudy != null">No
                      records available.</span>
                  </ng-template>
              </kendo-grid-column>
              </kendo-grid>
  </div>
  <button kendoButton (click)="onCancel($event)" style="color : white;background-color : rgb(7, 73, 130);border-color: white;font-family: Open Sans Regular;font-size: 12px;width: 70px;border-radius: 6px;margin-top: 10px;">Cancel</button>&nbsp;&nbsp;
  <button *ngIf="(isNew=='add' || isNew=='edit')" kendoButton [disabled]="!editBusinessForm.valid" (click)="onSave($event,isNew)"
    style="color : white;background-color :  rgb(7, 73, 130);border-color: white;font-family: Open Sans Regular;font-size: 12px;width: 70px;border-radius: 6px;margin-right: -150px;margin-top: 10px;">Submit</button>
  <button *ngIf="(isNew=='import')" kendoButton [disabled]="!editBusinessForm.valid" (click)="fetchTemplate()" style="color : white;background-color :  rgb(7, 73, 130);border-color: white;font-family: Open Sans Regular;font-size: 12px;width: 70px;border-radius: 6px;margin-right: -180px; margin-top: 10px;">Submit</button>
  <button *ngIf="(isNew=='delete')" kendoButton (click)="onDelete($event)" style="color : white;background-color :  rgb(7, 73, 130);border-color: white;font-family: Open Sans Regular;font-size: 12px;width: 70px;border-radius: 6px;margin-right: -180px; margin-top: 10px;">Ok</button>
  <button *ngIf="(isNew=='domainStatus')" kendoButton (click)="confirm($event)" style="color : white;background-color :  rgb(7, 73, 130);border-color: white;font-family: Open Sans Regular;font-size: 12px;width: 70px;border-radius: 6px;margin-right: -180px; margin-top: 10px;">Confirm</button>
</kendo-dialog>